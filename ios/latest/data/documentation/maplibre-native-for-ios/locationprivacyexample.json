{"identifier":{"interfaceLanguage":"occ","url":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre-Native-for-iOS\/LocationPrivacyExample"},"metadata":{"title":"User Location & Location Privacy","modules":[{"name":"MapLibre"}],"role":"article","roleHeading":"Article"},"kind":"article","abstract":[{"type":"text","text":"Requesting precise location with "},{"identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNLocationManager","type":"reference","isActive":true},{"text":".","type":"text"}],"schemaVersion":{"minor":3,"patch":0,"major":0},"sections":[],"seeAlsoSections":[{"generated":true,"title":"Features","identifiers":["doc:\/\/org.swift.MyProject\/documentation\/MapLibre-Native-for-iOS\/StaticSnapshotExample"],"anchor":"Features"}],"primaryContentSections":[{"content":[{"type":"aside","name":"Note","style":"note","content":[{"inlineContent":[{"text":"This example uses SwiftUI.","type":"text"}],"type":"paragraph"}]},{"type":"paragraph","inlineContent":[{"text":"This example shows how to request a precise location with ","type":"text"},{"isActive":true,"identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNLocationManager","type":"reference"},{"text":".","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"Let’s prepare your ","type":"text"},{"code":"Info.plist","type":"codeVoice"},{"text":":","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"First, provide a description why your app needs to access location:"}]},{"syntax":"plist","code":["<key>NSLocationWhenInUseUsageDescription<\/key>","<string>Dummy Location When In Use Description<\/string>"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Second, add a description why your app needs precise location:"}]},{"syntax":"plist","code":["<key>NSLocationTemporaryUsageDescriptionDictionary<\/key>","<dict>","  <key>MLNAccuracyAuthorizationDescription<\/key>","  <string>Dummy Precise Location Description<\/string>","<\/dict>"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"Third and finally, specify your app only needs reduced location access by default (until you request precise accuracy in the example):","type":"text"}]},{"syntax":"plist","code":["<key>NSLocationDefaultAccuracyReduced<\/key>","<true\/>"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"code":"Coordinator","type":"codeVoice"},{"text":" defined below is also the ","type":"text"},{"isActive":true,"identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapViewDelegate","type":"reference"},{"text":". When the location manager authorization changes it will call the relevant method. If precise location has not been granted, a button is shown at the bottom of the map.","type":"text"}]},{"type":"paragraph","inlineContent":[{"identifier":"ImpreciseLocation.png","type":"image"}]},{"type":"paragraph","inlineContent":[{"text":"When the button is pressed a pop-up with the description we set in ","type":"text"},{"type":"codeVoice","code":"Info.plist"},{"text":" will be shown:","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"image","identifier":"PreciseLocationRequestPopup.png"}]},{"syntax":"swift","code":["enum LocationAccuracyState {","    case unknown","    case reducedAccuracy","    case fullAccuracy","}","","@MainActor","class PrivacyExampleViewModel: NSObject, ObservableObject {","    @Published var locationAccuracy: LocationAccuracyState = .unknown","    @Published var showTemporaryLocationAuthorization = false","}","","class PrivacyExampleCoordinator: NSObject, MLNMapViewDelegate {","    @ObservedObject private var mapViewModel: PrivacyExampleViewModel","    private var pannedToUserLocation = false","","    init(mapViewModel: PrivacyExampleViewModel) {","        self.mapViewModel = mapViewModel","        super.init()","    }","","    @MainActor func mapView(_: MLNMapView, didChangeLocationManagerAuthorization manager: MLNLocationManager) {","        guard let accuracySetting = manager.accuracyAuthorization else {","            return","        }","","        switch accuracySetting() {","        case .fullAccuracy:","            mapViewModel.locationAccuracy = .fullAccuracy","        case .reducedAccuracy:","            mapViewModel.locationAccuracy = .reducedAccuracy","        @unknown default:","            mapViewModel.locationAccuracy = .unknown","        }","    }","","    \/\/ when a location is available for the first time, we fly to it","    func mapView(_ mapView: MLNMapView, didUpdate _: MLNUserLocation?) {","        guard !pannedToUserLocation else { return }","        guard let userLocation = mapView.userLocation else {","            print(\"User location is currently not available.\")","            return","        }","        mapView.fly(to: MLNMapCamera(lookingAtCenter: userLocation.coordinate, altitude: 100_000, pitch: 0, heading: 0))","        pannedToUserLocation = true","    }","}","","struct PrivacyExampleRepresentable: UIViewRepresentable {","    @ObservedObject var mapViewModel: PrivacyExampleViewModel","","    func makeCoordinator() -> PrivacyExampleCoordinator {","        PrivacyExampleCoordinator(mapViewModel: mapViewModel)","    }","","    func makeUIView(context: Context) -> MLNMapView {","        let mapView = MLNMapView()","","        mapView.delegate = context.coordinator","        mapView.showsUserLocation = true","        return mapView","    }","","    func updateUIView(_ mapView: MLNMapView, context _: Context) {","        if mapViewModel.showTemporaryLocationAuthorization {","            let purposeKey = \"MLNAccuracyAuthorizationDescription\"","            mapView.locationManager.requestTemporaryFullAccuracyAuthorization?(withPurposeKey: purposeKey)","            DispatchQueue.main.async {","                mapViewModel.showTemporaryLocationAuthorization = false","            }","        }","    }","}","","struct LocationPrivacyExampleView: View {","    @StateObject private var viewModel = PrivacyExampleViewModel()","","    var body: some View {","        VStack {","            PrivacyExampleRepresentable(mapViewModel: viewModel)","                .edgesIgnoringSafeArea(.all)","","            if viewModel.locationAccuracy == LocationAccuracyState.reducedAccuracy {","                Button(\"Request Precise Location\") {","                    viewModel.showTemporaryLocationAuthorization.toggle()","                }","                .padding()","                .background(Color.blue)","                .foregroundColor(.white)","                .cornerRadius(8)","            }","        }","    }","}"],"type":"codeListing"}],"kind":"content"}],"hierarchy":{"paths":[["doc:\/\/org.swift.MyProject\/documentation\/MapLibre"]]},"variants":[{"traits":[{"interfaceLanguage":"occ"}],"paths":["\/documentation\/maplibre-native-for-ios\/locationprivacyexample"]}],"references":{"doc://org.swift.MyProject/documentation/MapLibre/MLNLocationManager":{"role":"symbol","title":"MLNLocationManager","url":"\/documentation\/maplibre\/mlnlocationmanager","fragments":[{"kind":"identifier","text":"MLNLocationManager"}],"kind":"symbol","abstract":[{"type":"text","text":"The "},{"type":"reference","identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNLocationManager","isActive":true},{"type":"text","text":" protocol defines a set of methods that a class must"},{"type":"text","text":" "},{"type":"text","text":"implement in order to serve as the location manager of an "},{"type":"reference","identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapView","isActive":true},{"type":"text","text":". A location"},{"type":"text","text":" "},{"type":"text","text":"manager is responsible for notifying the map view about location-related events,"},{"type":"text","text":" "},{"type":"text","text":"such as a change in the user’s location. This protocol is similar to the"},{"type":"text","text":" "},{"type":"text","text":"Core Location framework’s "},{"type":"codeVoice","code":"CLLocationManager"},{"type":"text","text":" class, but your implementation"},{"type":"text","text":" "},{"type":"text","text":"does not need to be based on "},{"type":"codeVoice","code":"CLLocationManager"},{"type":"text","text":"."}],"type":"topic","identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNLocationManager"},"doc://org.swift.MyProject/documentation/MapLibre":{"kind":"symbol","title":"MapLibre","identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre","role":"collection","type":"topic","url":"\/documentation\/maplibre","abstract":[{"type":"text","text":"Powerful, free and open-source mapping toolkit with full control over data sources and styling."}]},"doc://org.swift.MyProject/documentation/MapLibre/MLNMapSnapshotter":{"title":"MLNMapSnapshotter","type":"topic","fragments":[{"text":"MLNMapSnapshotter","kind":"identifier"}],"abstract":[{"text":"An ","type":"text"},{"identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapSnapshotter","isActive":true,"type":"reference"},{"text":" generates static raster images of the map. Each snapshot","type":"text"},{"text":" ","type":"text"},{"text":"image depicts a portion of a map defined by an ","type":"text"},{"identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapSnapshotOptions","isActive":true,"type":"reference"},{"text":" object","type":"text"},{"text":" ","type":"text"},{"text":"you provide. The snapshotter generates an ","type":"text"},{"identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapSnapshot","isActive":true,"type":"reference"},{"text":" object","type":"text"},{"text":" ","type":"text"},{"text":"asynchronously, calling ","type":"text"},{"identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapSnapshotterDelegate","isActive":true,"type":"reference"},{"text":" methods if defined, then","type":"text"},{"text":" ","type":"text"},{"text":"passing it into a completion handler once tiles and other resources needed for","type":"text"},{"text":" ","type":"text"},{"text":"the snapshot are finished loading.","type":"text"}],"role":"symbol","identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapSnapshotter","url":"\/documentation\/maplibre\/mlnmapsnapshotter","kind":"symbol"},"ImpreciseLocation.png":{"variants":[{"traits":["2x","light"],"url":"\/images\/org.swift.MyProject\/ImpreciseLocation@2x.png"}],"type":"image","identifier":"ImpreciseLocation.png","alt":null},"doc://org.swift.MyProject/documentation/MapLibre-Native-for-iOS/StaticSnapshotExample":{"role":"article","kind":"article","title":"Making Snapshots","abstract":[{"text":"Use ","type":"text"},{"isActive":true,"identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapSnapshotter","type":"reference"},{"text":" to create snapshots of the map.","type":"text"}],"url":"\/documentation\/maplibre-native-for-ios\/staticsnapshotexample","identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre-Native-for-iOS\/StaticSnapshotExample","type":"topic"},"doc://org.swift.MyProject/documentation/MapLibre/MLNMapViewDelegate":{"kind":"symbol","identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapViewDelegate","role":"symbol","url":"\/documentation\/maplibre\/mlnmapviewdelegate","fragments":[{"kind":"identifier","text":"MLNMapViewDelegate"}],"title":"MLNMapViewDelegate","type":"topic","abstract":[{"type":"text","text":"The "},{"type":"reference","identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapViewDelegate","isActive":true},{"type":"text","text":" protocol defines a set of optional methods that you"},{"type":"text","text":" "},{"type":"text","text":"can use to receive map-related update messages. Because many map operations"},{"type":"text","text":" "},{"type":"text","text":"require the "},{"type":"reference","identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapView","isActive":true},{"type":"text","text":" class to load data asynchronously, the map view calls"},{"type":"text","text":" "},{"type":"text","text":"these methods to notify your application when specific operations complete. The"},{"type":"text","text":" "},{"type":"text","text":"map view also uses these methods to request information about annotations"},{"type":"text","text":" "},{"type":"text","text":"displayed on the map, such as the styles and interaction modes to apply to"},{"type":"text","text":" "},{"type":"text","text":"individual annotations."}]},"doc://org.swift.MyProject/documentation/MapLibre/MLNMapView":{"kind":"symbol","abstract":[{"type":"text","text":"An interactive, customizable map view with an interface similar to the one"},{"type":"text","text":" "},{"type":"text","text":"provided by Apple’s MapKit."}],"url":"\/documentation\/maplibre\/mlnmapview","type":"topic","fragments":[{"kind":"identifier","text":"MLNMapView"}],"identifier":"doc:\/\/org.swift.MyProject\/documentation\/MapLibre\/MLNMapView","role":"symbol","title":"MLNMapView"},"PreciseLocationRequestPopup.png":{"variants":[{"traits":["2x","light"],"url":"\/images\/org.swift.MyProject\/PreciseLocationRequestPopup@2x.png"}],"type":"image","identifier":"PreciseLocationRequestPopup.png","alt":null}}}