# Advanced Plugin Example (Arrow Polyline)

A cross-platform plugin using [Gluecodium](https://github.com/heremaps/gluecodium) for automatic Swift/Kotlin binding generation.

## Overview

In the basic plugin example, we wrote the ios and android language bindings by hand. Instead, in this example we will utilize gluecodium to auto generate the bindings and provide a richer,  consistent API to the platforms.

## Usage

### iOS (Swift)

```swift
import GluecodiumArrowPolyline
import ArrowPolylineGluecodiumPluginBridge

let plugin = ArrowPolylineExample()
let mapView = MLNMapView(frame: frame, styleURL: nil, plugins: [plugin.bridge])

let coords = [
    LatLng(latitude: 37.8044, longitude: -122.2712),
    LatLng(latitude: 37.7749, longitude: -122.4194),
]

let config = ArrowPolylineConfig(
    headLength: 30.0,
    headAngle: 25.0,
    lineColor: "#0066FF",
    lineWidth: 4.0
)

plugin.addArrowPolyline(coordinates: coords, config: config)
```

### Android (Kotlin)

```kotlin
import com.example.GluecodiumPlugin.ArrowPolylineExample
import com.example.GluecodiumPlugin.ArrowPolylineConfig
import com.example.GluecodiumPlugin.LatLng

val plugin = ArrowPolylineExample()
mapView.addPluginByPtr(plugin.ptr)

val coords = listOf(
    LatLng(37.8044, -122.2712),
    LatLng(37.7749, -122.4194),
)

val config = ArrowPolylineConfig().apply {
    headLength = 30.0
    headAngle = 25.0
    lineColor = "#0066FF"
    lineWidth = 4.0
}

plugin.addArrowPolyline(coords, config)
```

## Structure

NOTE: The plugin system does not enforce a specific build system, this is just an example, which uses bazel for swift and CMake for Android, but this may not be what you want for your project.

```
arrow-polyline-example-plugin/
├── src/
│   ├── ArrowPolylineExampleImpl.hpp  # C++ implementation header
│   └── ArrowPolylineExampleImpl.cpp  # C++ implementation
├── api/
│   └── ArrowPolylineExample.lime     # Gluecodium API definition
├── generated/                        # Auto-generated by Gluecodium
│   ├── cpp/                          # C++ interfaces
│   ├── swift/                        # Swift bindings
│   ├── android/jni/                  # JNI bindings
│   └── cbridge/                      # C bridge for Swift
├── ios/
│   ├── MaplibreGluecodiumPluginBridge.h   # Bridge to MLNMapView
│   ├── MaplibreGluecodiumPluginBridge.mm
│   └── CBridgeExport.swift           # Swift module export
├── BUILD.bazel                       # Bazel build (iOS)
└── CMakeLists.txt                    # CMake build (Android)
```

## Regenerating Bindings

When modifying `api/ArrowPolylineExample.lime`, regenerate bindings from the Gluecodium directory:

```bash
./gradlew run --args='-input <path-to-plugin>/api/ArrowPolylineExample.lime \
  -output <path-to-plugin>/generated \
  -generators android,cpp,swift \
  -javapackage com.example \
  -intnamespace glue_internal'
```

## How It Works

1. **LimeIDL** defines the API in a language-neutral way
2. **Gluecodium** generates Swift, Kotlin, and C++ bindings
3. **ArrowPolylineExampleImpl** implements the generated C++ interface
4. Platform code uses generated bindings which call through to C++
5. The `.bridge` property (iOS) or `.ptr` (Android) provides the `XPlatformPlugin` pointer
